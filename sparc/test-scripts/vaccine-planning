% Situation
%=== The following is an except from a CPG and a local customization of the CPG ===

% A general CPG (Clinical Practice Guideline) states

% "There are two different brands of Hib vaccine, HbOC and PRPOMP. The guideline recommends that a child should receive all of one brand or all of the other. It takes four doses to complete the series using HbOC and three doses using PRPOMP.

% If a child has already received both brands (a “mixed series”), then all doses are treated as if they were HbOC and the four-dose schedule is used."

% A local customization of the CPG allows a special schedule using PRPOMP for dose 1 and HbOC for doses 2–4.

% ======

#const n = 10.

sorts
    #step = 0 .. n.
    #cur_dose = 0 .. n.
    #person = {hanayo}.
    #vaccine = {hboc,prpomp}.
    #completed = {complete, incomplete}.
    #bool = {true, false}.
    #fluent = contains(#person, #vaccine, #cur_dose, #completed).
    #action = give(#person, #vaccine).
    
predicates
    holds(#fluent, #step).
    occurs(#action, #step).
    mixed_series(#person, #step).
    
    
    happens(#step).
    
    inital_state(#person, #step).
    success(#bool).
    goal(#step).
    
    
rules

    % The person contains a vaccine dose if he/she was given a vaccine dose
    % Person P contains vaccine X at step I+1,if person P is given vaccine X at step I
    
    %holds(contains(P,X,D+1,C),I+1):- occurs(give(P,X),I).

    % Inertia axiom
    %holds(contains(P,hboc,D+1,incomplete),I+1):- holds(contains(P, hboc, D, C),I).

    holds(contains(P,hboc,D+1,complete),I+1):-
            holds(contains(P, hboc, D, C),I),
            occurs(give(P,hboc),I),
            (D+1)= 4.

    holds(contains(P,hboc,D+1,incomplete),I+1):-
            holds(contains(P, hboc, D, C),I),
            occurs(give(P,hboc),I),
            (D+1) < 4.

    %holds(contains(P,hboc,D+1,complete),I+1):- 
    %    holds(contains(P,hboc,D,C),I),
    %    occurs(give(P,hboc),I),
    %    (D+1) = 4.
    
    %holds(contains(P,hboc,D+1,incomplete),I+1):- 
    %    holds(contains(P,hboc,D,C),I),
    %    occurs(give(P,hboc),I),
    %    (D+1) < 4.
    
    

    % Person P has mixed series at step I,
    %   if person P contains vaccine A at step I,  
    %   if person P contains vaccine B at step I,
    %   A does NOT equal to B
    
    %mixed_series(P,I):-
    %    holds(contains(P,A,D,C),I),
    %    holds(contains(P,B,D,C),I),
    %    A != B.
        

     % If something happens, something occurs
    happens(I) :- occurs(A,I).
    
    % Do not allow concurrent actions
    :- occurs(give(P,X1),I),
        occurs(give(P,X2),I),
        X1 != X2.
    
    %%%%%%%%%%% Goal and Success states %%%%%%%%%%%

    % When goal is not reached, an action must be selected at each step
    occurs(A,I) | -occurs(A,I) :- not goal(I).
    
    % Something happens when something is occuring
    happens(I) :- occurs(A,I).
    
    % Sucess is reached when the goal has been reached
    success(true) :- goal(I), I <= 4.
    
    % Success must be reached
    :- not success(true).
    
    % It is not possible for nothing to happen while the goal is not reached
    :- not happens(I), not goal(I).
 
 

 
    
    % Defined goal
    goal(I):- holds(contains(hanayo,V,D,complete),I).
       




    %%%%%% Inital State %%%%%%
    holds(contains(hanayo,hboc,0,incomplete),0).
    


display
    holds(X1,Y1).
    occurs(X2,Y2).
